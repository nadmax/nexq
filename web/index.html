<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Nexq - Dashboard</title>
</head>
<body>
    <div class="container">
        <h1>Nexq - Dashboard</h1>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('main', this)">Tasks</button>
            <button class="tab" onclick="switchTab('dlq', this)">Dead Letter Queue</button>
            <button class="tab" onclick="switchTab('history', this)">History</button>
            <button class="tab" onclick="switchTab('docs', this)">Docs</button>
        </div>

        <div id="main-tab" class="tab-content active">
            <div class="create-task">
                <h2>Create New Task</h2>
                <form id="taskForm">
                    <div class="task-form-layout">
                        <div class="editor-column">
                            <label>Payload (JSON)</label>
                            <div class="editor-wrapper">
                                <div id="editor"></div>
                            </div>
                        </div>
                        <div class="controls-column">
                            <div class="form-group">
                                <label>Task Type</label>
                                <select id="taskType">
                                    <option value="generate_report">Generate Report</option>
                                    <option value="process_image">Process Image</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Priority</label>
                                <select id="priority">
                                    <option value="0">Low</option>
                                    <option value="1" selected>Medium</option>
                                    <option value="2">High</option>
                                </select>
                            </div>
                            <button type="submit">Create Task</button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="tasks">
                <h2>Current Queue Tasks</h2>
                <div id="taskList"></div>
            </div>

            <div class="stats">
                <h2>Statistics</h2>
                <div id="stats">Loading...</div>
            </div>
        </div>

        <div id="history-tab" class="tab-content">
            <div class="tasks">
                <h2>Recent Task History</h2>
                <div class="form-group">
                    <label>Show</label>
                    <select id="historyLimit" onchange="loadRecentHistory()">
                        <option value="20">20 tasks</option>
                        <option value="50" selected>50 tasks</option>
                        <option value="100">100 tasks</option>
                    </select>
                </div>
                <div id="historyList"></div>
            </div>

            <div class="stats">
                <h2>Task History</h2>
                <div class="form-group">
                    <label>Time Range</label>
                    <select id="historyHours" onchange="loadHistoryStats()">
                        <option value="1">Last Hour</option>
                        <option value="6">Last 6 Hours</option>
                        <option value="24" selected>Last 24 Hours</option>
                        <option value="168">Last 7 Days</option>
                    </select>
                </div>
                <div id="historyStats">Loading...</div>
            </div>
        </div>

        <div id="dlq-tab" class="tab-content">
            <div class="tasks">
                <h2>Failed Tasks</h2>
                <div id="dlqList"></div>
            </div>

            <div class="stats">
                <h2>Dead Letter Queue Statistics</h2>
                <div id="dlqStats">Loading...</div>
            </div>
        </div>

        <div id="docs-tab" class="tab-content">
            <div class="docs-section">
                <h3>Getting Started</h3>
                <p>Nexq is a task queue system that allows you to create, schedule, and manage background tasks. This documentation provides examples of how to interact with the Dashboard.</p>
            </div>

            <div class="docs-section">
                <h3>API Endpoints</h3>
                <table class="params-table" id="api-endpoints-table">
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortTable('api-endpoints-table', 0)">Method <span></span></th>
                            <th class="sortable" onclick="sortTable('api-endpoints-table', 1)">Endpoint <span></span></th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="endpoint-badge get">GET</span></td>
                            <td><code>/api/tasks</code></td>
                            <td>List all tasks</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge get">GET</span></td>
                            <td><code>/api/tasks/{id}</code></td>
                            <td>Get task by ID</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge get">GET</span></td>
                            <td><code>/api/dashboard/stats</code></td>
                            <td>Get dashboard statistics</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge get">GET</span></td>
                            <td><code>/api/dashboard/history</code></td>
                            <td>Get recent task history</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge get">GET</span></td>
                            <td><code>/api/dlq/tasks</code></td>
                            <td>List all failed tasks</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge get">GET</span></td>
                            <td><code>/api/dlq/stats</code></td>
                            <td>Get dead letter queue statistics</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge get">GET</span></td>
                            <td><code>/api/history/stats</code></td>
                            <td>Get stats for the last 24 hours</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge get">GET</span></td>
                            <td><code>/api/history/stats?hours={hours}</code></td>
                            <td>Get stats for the last specified hours</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge get">GET</span></td>
                            <td><code>/api/history/recent</code></td>
                            <td>Get the last 100 tasks</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge get">GET</span></td>
                            <td><code>/api/history/recent?limit={limit}</code></td>
                            <td>Get the last specified numbers of tasks</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge get">GET</span></td>
                            <td><code>/api/history/task/{id}</code></td>
                            <td>Get execution history for a specific task</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge get">GET</span></td>
                            <td><code>/api/history/type/{task_type}</code></td>
                            <td>Get tasks by type</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge get">GET</span></td>
                            <td><code>/api/history/type/{task_type}?limit={limit}</code></td>
                            <td>Get a specific number of tasks by type</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge post">POST</span></td>
                            <td><code>/api/tasks</code></td>
                            <td>Create a new task</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge post">POST</span></td>
                            <td><code>/api/tasks/cancel/{id}</code></td>
                            <td>Cancel a task by ID</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge post">POST</span></td>
                            <td><code>/api/dlq/tasks/{id}/retry</code></td>
                            <td>Retry a failed task</td>
                        </tr>
                        <tr>
                            <td><span class="endpoint-badge delete">DELETE</span></td>
                            <td><code>/api/dlq/tasks/{id}</code></td>
                            <td>Delete a failed task permanently</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="docs-section">
                <h3>Task Types</h3>
                <div class="task-types-grid">
                    <div class="task-type-card">
                        <h4>process_image</h4>
                        <p>Process and transform images</p>
                        <p><strong class="required-label">Required:</strong> <code>image_url</code>, <code>operations</code></p>
                    </div>
                    <div class="task-type-card">
                        <h4>generate_report</h4>
                        <p>Generate performance report and analytics </p>
                        <p><strong class="required-label">Required:</strong> <code>report_type</code></p>
                        <p><strong class="optional-label">Optional:</strong> <code>start_time</code>, <code>end_time</code>, <code>format</code>, <code>output_path</code>, <code>schedule_in</code></p>
                    </div>
                </div>
            </div>

            <div class="docs-section">
                <h3>Examples</h3>
                <div class="example-title">Generate performance report for later</div>
                <p>Create a task that generates a performance report with customizable date range, format, output path, and scheduling (in seconds):</p>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this, 1)">Copy</button>
                    <div class="code-block-editor" id="example-1"></div>
                </div>

                <div class="example-title">Process image task</div>
                <p>Create a task to process an image:</p>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this, 2)">Copy</button>
                    <div class="code-block-editor" id="example-2"></div>
                </div>
            </div>
         </div>
    </div>

    <div id="executionModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Execution History</h3>
                <button class="modal-close" onclick="closeExecutionModal()">&times;</button>
            </div>
            <div id="executionHistory"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.53.0/min/vs/loader.min.js"></script>
    <script src="index.js"></script>
</body>
</html>
